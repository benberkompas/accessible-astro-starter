---
import { Card, Heading, Link } from 'accessible-astro-components'
import { Icon } from 'astro-icon/components'
import { getSubstackPosts, formatPubDate, type SubstackPost } from '@lib/substack'

/**
 * FeaturedPosts Component
 *
 * @description Displays featured posts from the Substack newsletter (RSS, build time).
 */
interface Props {
  /**
   * Additional classes to apply to the section
   */
  class?: string
  /**
   * The number of posts to display
   * @default 3
   */
  limit?: number
  /**
   * The title for the section
   * @default "Latest from the newsletter"
   */
  title?: string
}

const { class: className, limit = 3, title = 'Latest from the newsletter' } = Astro.props

const allPosts = await getSubstackPosts()
const featuredPosts: SubstackPost[] = allPosts.slice(0, limit)
---

<section class:list={[className, 'my-64']}>
  <div class="container">
    <Heading level="h2" class="mb-6">{title}</Heading>
    {featuredPosts.length === 0 ? (
      <p class="text-lg">
        <Link href="/blog/" isButton animateOnHover animationType="nudge">
          View writing
          <Icon aria-hidden="true" name="lucide:arrow-right" size="1.5rem" />
        </Link>
      </p>
    ) : (
      <>
        <div class="grid grid-cols-1 gap-12 md:grid-cols-2 lg:grid-cols-3">
          {
            featuredPosts.map((post) => (
              <Card
                url={post.link}
                title={post.title}
                headingLevel="h2"
                footer={formatPubDate(post.pubDate)}
              >
                {post.contentSnippet || 'Read more on Substack.'}
              </Card>
            ))
          }
        </div>
        <div class="mt-12">
          <Link href="/blog/" isButton animateOnHover animationType="nudge">
            Read all posts
            <Icon aria-hidden="true" name="lucide:arrow-right" size="1.5rem" />
          </Link>
        </div>
      </>
    )}
  </div>
</section>
